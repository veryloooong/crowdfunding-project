{% load i18n %}

{% if request.user.is_authenticated %}
  <div class="card bg-base-200">
    <div class="card-body">
      <h3 class="font-semibold">{% trans "Donate" %}</h3>
      <form
        method="post"
        action="/donations/campaign/{{ campaign.id }}/"
        hx-post="/donations/campaign/{{ campaign.id }}/"
        hx-target="#donation-panel-{{ campaign.id }}"
        hx-swap="outerHTML"
        id="donate-form-{{ campaign.id }}"
        class="space-y-2"
      >
        {% csrf_token %}
        <label class="form-control">
          <div class="label"><span class="label-text">{% trans "Amount (VND)" %}</span></div>
          <input class="input input-bordered w-full" name="amount" type="number" step="1000" min="1000" required />
        </label>

        <label class="form-control">
          <div class="label"><span class="label-text">{% trans "Display name (optional)" %}</span></div>
          <input class="input input-bordered w-full" name="display_name" />
        </label>

        {% if request.user.groups_member.all %}
          <label class="form-control">
            <div class="label"><span class="label-text">{% trans "Donate as group (optional)" %}</span></div>
            <select class="select select-bordered w-full" name="group_id">
              <option value="">{% trans "No group" %}</option>
              {% for g in request.user.groups_member.all %}
                <option value="{{ g.id }}">{{ g.name }}</option>
              {% endfor %}
            </select>
          </label>
        {% endif %}

        <label class="label cursor-pointer justify-start gap-2">
          <input type="checkbox" class="checkbox" name="is_anonymous" />
          <span class="label-text">{% trans "Donate anonymously" %}</span>
        </label>

        {% if campaign.donate_qr_image_url %}
          <input type="checkbox" id="donate-qr-modal-{{ campaign.id }}" class="modal-toggle" />
          <div class="modal" role="dialog">
            <div class="modal-box">
              <h3 class="font-bold text-lg">{% trans "Donate" %}</h3>
              <div class="mt-3">
                <img class="rounded-box w-full" src="{{ campaign.donate_qr_image_url }}" alt="Donate QR" />
              </div>
              <div class="modal-action">
                <button class="btn btn-primary" type="submit" form="donate-form-{{ campaign.id }}">{% trans "Donate" %}</button>
                <label class="btn" for="donate-qr-modal-{{ campaign.id }}">{% trans "Close" %}</label>
              </div>
            </div>
            <label class="modal-backdrop" for="donate-qr-modal-{{ campaign.id }}">{% trans "Close" %}</label>
          </div>

          <label class="btn btn-primary w-full" for="donate-qr-modal-{{ campaign.id }}">{% trans "Donate" %}</label>
        {% else %}
          <button class="btn btn-primary w-full" type="submit">{% trans "Donate" %}</button>
        {% endif %}
      </form>
    </div>
  </div>
{% else %}
  <div class="card bg-base-200">
    <div class="card-body">
      <div class="alert alert-info"><span>{% trans "Login is required to donate." %}</span></div>
      <a class="btn btn-primary" href="/accounts/login/?next=/campaigns/{{ campaign.id }}/">{% trans "Login" %}</a>
    </div>
  </div>
{% endif %}
