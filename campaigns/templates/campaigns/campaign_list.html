{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Campaigns" %}{% endblock %}

{% block content %}
  <div class="flex flex-col gap-4">
    <div class="card bg-base-100">
      <div class="card-body">
        <h1 class="text-3xl font-bold mb-2">{% trans "Campaigns" %}</h1>

        <form method="get" class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
          <label class="form-control">
            <div class="label"><span class="label-text">{% trans "Search" %}</span></div>
            <input class="input input-bordered w-full" type="text" name="q" value="{{ q }}" placeholder="{% trans 'title or description' %}" />
          </label>

          <label class="form-control">
            <div class="label"><span class="label-text">{% trans "Category" %}</span></div>
            <select class="select select-bordered w-full" name="category">
              <option value="">{% trans "All" %}</option>
              {% for c in categories %}
                <option value="{{ c.slug }}" {% if category == c.slug %}selected{% endif %}>{{ c.name }}</option>
              {% endfor %}
            </select>
          </label>

          <label class="form-control">
            <div class="label"><span class="label-text">{% trans "Tag" %}</span></div>
            <input class="input input-bordered w-full" type="text" name="tag" value="{{ tag }}" placeholder="{% trans '#tag name' %}" />
          </label>

          <label class="form-control">
            <div class="label"><span class="label-text">{% trans "Sort" %}</span></div>
            <select class="select select-bordered w-full" name="sort">
              <option value="" {% if not sort %}selected{% endif %}>{% trans "Newest" %}</option>
              <option value="popular" {% if sort == "popular" %}selected{% endif %}>{% trans "Popular" %}</option>
              <option value="urgent" {% if sort == "urgent" %}selected{% endif %}>{% trans "Urgent" %}</option>
            </select>
          </label>

          <div class="flex items-end gap-2">
            <button class="btn btn-primary" type="submit">{% trans "Apply" %}</button>
            <a class="btn btn-ghost" href="/">{% trans "Reset" %}</a>
          </div>
        </form>

        {% if request.user.is_authenticated %}
          <div class="mt-4">
            <a class="btn btn-secondary" href="/campaigns/new/">{% trans "Create campaign" %}</a>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {% for campaign in campaigns %}
        <div class="card bg-base-100">
          <div class="card-body">
            {% if campaign.image_url %}
              <figure class="mb-3">
                <img class="rounded-box w-full" src="{{ campaign.image_url }}" alt="{{ campaign.title }}" />
              </figure>
            {% endif %}

            <div class="flex items-start justify-between gap-4">
              <div>
                <h2 class="text-xl font-semibold mb-1">
                  <a class="link link-hover" href="/campaigns/{{ campaign.id }}/">{{ campaign.title }}</a>
                </h2>
                <div class="text-sm text-base-content/70">{% trans "Ends" %}: {{ campaign.end_date }}</div>
              </div>
              {% if campaign.is_active %}
                <div class="badge badge-success">{% trans "On-going" %}</div>
              {% else %}
                <div class="badge badge-neutral">{% trans "Ended" %}</div>
              {% endif %}
            </div>

            <p class="text-base text-base-content mt-2">{{ campaign.description|truncatechars:180 }}</p>

            <div class="mt-3">
              {% include "campaigns/partials/progress.html" with campaign=campaign %}
            </div>

            {% if campaign.categories.all %}
              <div class="mt-3 flex flex-wrap gap-2">
                {% for c in campaign.categories.all %}
                  <span class="badge badge-accent badge-outline">{{ c.name }}</span>
                {% endfor %}
              </div>
            {% endif %}

            {% if campaign.tags.all %}
              <div class="mt-2 flex flex-wrap gap-2">
                {% for t in campaign.tags.all %}
                  <span class="badge badge-outline">#{{ t.name }}</span>
                {% endfor %}
              </div>
            {% endif %}

            <div class="card-actions justify-end mt-4">
              <a class="btn btn-primary" href="/campaigns/{{ campaign.id }}/">{% trans "View" %}</a>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="card bg-base-100 md:col-span-2">
          <div class="card-body">
            <div class="alert alert-info"><span>{% trans "No campaigns found." %}</span></div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}
